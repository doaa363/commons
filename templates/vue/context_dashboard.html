{% extends "commons_base.html" %}
{% load staticfiles %}
{% load i18n %}
{% block head_title %}Context Dashboard{% endblock %}
{% block extra_style %}

    <!-- MMR link href="//cdn.bootcss.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet">
    <link href="//cdn.bootcss.com/highlight.js/9.5.0/styles/default.min.css" rel="stylesheet"-->
<style>
.kwic {
    padding:3px 10px 3px 10px;
    display: grid;
    grid-template-columns: 5% 15% 80%;
    // grid-template-columns: auto auto auto;
    text-align: center;
}
.kw {
    text-align: left;
    font-size:100%;
    font-weight: bold;
}
.context {
    padding: 3px 10px 3px 10px;
    display: grid;
    grid-template-columns: 34% 10% auto;
    /*grid-template-columns: 20% 10% 20%;
    grid-template-columns: auto auto auto auto auto;
    */
    font-size:85%;
    background: #fff;
    border-bottom: 1px dotted #8c8c8c;
    border-right:1px solid #8c8c8c;
    border-left:1px solid #8c8c8c;
}
.context:hover {
  background-color: #F4F4F4;
}
.panel-heading-context {
    color: #fff;
    background: #8c8c8c;
}
.panel-heading-context a {
    color: #fff;
}
.panel-heading-context a:hover {
	color: #ebeded;
}
</style>
{% endblock extra_style %}

{% block extra_head %}
    <script src="{% static "nlp/js/jquery.min.js" %}"></script>
    <script src="{% static "vue/vue.js" %}"></script>
{% endblock extra_head %}

{% block body_class %}context_dashboard{% endblock %}
{% block nav %}
  <div class="navbar">
    <h4 class="text-center">{% trans "keywords in context"|capfirst %}</h4>
  </div>
{% endblock nav %}

{% block body_base %}
  {% verbatim %}
  <div id="app">
    <div class="container-fluid marginTB20">
      <div class="box100" v-for="(kwic, index) in kwics">
        <div class="panel-heading-context padding510 demiBold"><a href="#" class="marginR10" onclick="toggle_icon($(this)); return false;"><i class="fa fa-plus-square"></i></a><span class="marginR10">{{ kwic.frequency }}</span><span class="kw">{{ kwic.kw }}</span></div>
        <div style="display:none">
          <div class="context" v-for="context in kwic.contexts">
            <div class="text-right">{{ context[0] }}</div><div class="text-center"><span class="bold" style="letter-spacing:-1px">{{ context[1] }}</span></div><div>{{ context[2] }}</div>
          </div>
        </div>
      </div>
      <div v-if="error">{{ error }}</div>
    </div>
  </div>
  {% endverbatim %}
{% endblock body_base %}

{% block footer_base %}
{% endblock footer_base %}

{% block script_base %}
<script type="text/javascript" src="{% static "js/bootstrap.min.js" %}"></script>
<script type="text/javascript">
  var app = new Vue({
    name: 'context_dashboard',
    data: {
      file_key: '{{ file_key }}',
      obj_type: '{{ obj_type }}',
      obj_id: '{{ obj_id }}',
      kwics: [],
      result: [],
      error: '',
      window: 2,
    },
    el: '#app',
    methods: {
    },
    mounted: function () {
      fetch('/context_dashboard/'+this['file_key']+'/'{% if obj_type %}+this['obj_type']+'/'+this['obj_id']+'/'{% endif %}, {
        method: 'GET',
        headers: {"X-Requested-With": "XMLHttpRequest"}, // this is just a patch
      })
      .then(response => response.json())
      .then(data => {this['kwics'] = data['kwics']; this['result'] = data['kwics'];})
      .catch(err => (this['error'] = err))
    },
  });

  function toggle_icon(element){
        $("body").css("cursor", "default");
        console.log("entro");
        var accordion = element.parent();
        var accordionContent = accordion.next('div');
        var accordionToggleIcon = element;
        accordion.toggleClass("open");
        accordionContent.slideToggle(200);
        if (accordion.hasClass("open")) {
            accordionToggleIcon.children('i').attr("class","fa fa-minus-square");
            accordionContent.attr("style", "display: block;")
        } else {
            accordionToggleIcon.children('i').attr("class","fa fa-plus-square");
        }
  }
</script>
{% endblock script_base %}