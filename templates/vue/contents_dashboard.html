{% extends "commons_base.html" %}
{% load staticfiles %}
{% load i18n %}
{% block head_title %}Contents Dashboard{% endblock %}
{% block extra_style %}
    <!-- MMR link href="//cdn.bootcss.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet">
    <link href="//cdn.bootcss.com/highlight.js/9.5.0/styles/default.min.css" rel="stylesheet"-->
    <link rel="stylesheet" href="{% static "vue_apps/vddl/vddl.css" %}">
<style>
.wrapper {
    min-height: 0;
    margin:0;
    padding:0;
}
h3 {
    margin-top:0;
    margin-bottom:0;
    padding-top: 5px;
    padding-bottom: 5px;
    border-top-left-radius:4px;
    border-top-right-radius:4px;
}
    
.list-e .box-e:nth-child(4n+1) {
    clear: both;
}
.list-e > div {
  width: 24%;
  height: auto;
  float: left;
  margin: 0 1em 1em 0;
  background: #fff;
  border: 1px solid #67AE73;
  border-top-left-radius:4px;
  border-top-right-radius:4px;
}
.list-r > div {
  width:100%;
  margin: 0 1em 1em 0;
  background: #fff;
  border: 1px solid #8c8c8c;
  border-top-left-radius:4px;
  border-top-right-radius:4px;
}
  

.list-e > div.box100  {
    width:100%;
}
div.vddl-draggable {
    padding:3px 10px 3px 10px;
    border-bottom: 1px dotted #67AE73;
    font-size:90%;
}
div.vddl-draggable:first {
    padding-top: 6px;
}
div.vddl-draggable:last {
    border-bottom:none;
}
.panel-heading-r {
    color: #fff;
    background: #8c8c8c;
}

</style>
{% endblock extra_style %}

{% block extra_head %}
    <script src="{% static "nlp/js/jquery.min.js" %}"></script>
{% comment %}
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.12/dist/vue.js"></script>
    <script type="module" src="https://cdn.jsdelivr.net/npm/sortablejs@1.13.0/Sortable.js"></script>
    <script type="module" src="https://cdn.jsdelivr.net/npm/vuedraggable@2.24.3/src/vuedraggable.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vddl@0.7.1/dist/vddl.js"></script>
{% endcomment %}
    <script src="{% static "vue/vue.js" %}"></script>
    <script type="module" src="{% static "vue_apps/sortable/Sortable.js" %}"></script>
    <script type="module" src="{% static "vue_apps/vuedraggable/vuedraggable.js" %}"></script>
    <script src="{% static "vue_apps/vddl/vddl.js" %}"></script>
{% endblock extra_head %}

{% block body_class %}contents_dashboard{% endblock %}

{% block nav %}
  <div class="navbar">
    <h2 class="text-center">Contents Dashboard</h2>
  </div>
{% endblock nav %}

{% block body_base %}
    {% verbatim %}
    <div id="app">
      <div class="container-fluid marginTB20">
        <!-- MMR versione a 4 pannelli
        <div class="list-e">
            <div class="box-e" v-for="list in lists">
              <h3 class="text-center panel-heading-c0">{{ list.label }}</h3>
              <vddl-list :list=list.els class="drop-zone box-scroll box-small"
              :inserted="handleInserted"
              :dragover="handleDragover"
              :drop="handleDrop">
                <vddl-draggable v-for="item in list.els" v-bind:key="item.id"
                :draggable=item
                :index=item['index']
                :wrapper=list.els
                effect-allowed="move"
                :selected="selectedEvent"
                :dragstart="handleDragstart"
                :dragend="handleDragend"
                :canceled="handleCanceled"
                :moved="handleMoved"
                v-bind:class="{'selected': list.selected === item}"
                >
                <div>{{ item.label }}</div>
                </vddl-draggable>
              </vddl-list>
            </div>
        </div -->
        
        <div class="list-e">
          <div class="box100" v-for="list in lists">
            <div class="panel-heading-c0 padding510 demiBold"><a class="toggleIcon" href="#"><i class="fa fa-plus-square"></i></a> &nbsp; {{ list.label }}</div>
            <vddl-list :list=list.els class="box-scroll box-small" style="display:none"
              :inserted="handleInserted"
              :dragover="handleDragover"
              :drop="handleDrop">
                <vddl-draggable v-for="item in list.els" v-bind:key="item.id"
                :draggable=item
                :index=item['index']
                :wrapper=list.els
                effect-allowed="move"
                :selected="selectedEvent"
                :dragstart="handleDragstart"
                :dragend="handleDragend"
                :canceled="handleCanceled"
                :moved="handleMoved"
                v-bind:class="{'selected': list.selected === item}"
                >
                <div><!--a href="item.url"-->{{ item.label }}<!--/a--></div>
                </vddl-draggable>
              </vddl-list>
          </div>
        </div>
        <hr>
        <div class="list-r" style="clear:both">
          <div>
            <div class="panel-heading-r padding510 demiBold">Selected set of Contents</div>
            <vddl-list :list=corpus.els
            :inserted="handleInserted"
            :dragover="handleDragover"
            :drop="handleDrop">
              <vddl-draggable v-for="item in corpus.els" v-bind:key="item.id"
              :draggable=item
              :index=item['index']
              :wrapper=corpus.els
               effect-allowed="move"
              :selected="selectedEvent"
              :dragstart="handleDragstart"
              :dragend="handleDragend"
              :canceled="handleCanceled"
              :moved="handleMoved"
               v-bind:class="{'selected': corpus.selected === item}"
              >
              <div><!--a href="item.url"-->{{ item.label }}<!--/a--></div>
            </vddl-draggable>
            </vddl-list>
          </div>
        </div>
        <div id="commands"><button v-on:click="compareSelected();">Compare</button></div>
        <div id="result" class="vddl-list">{{ result }}</div>
      </div>
    </div>
    {% endverbatim %}
{% endblock body_base %}
{% block footer_base %}
{% endblock footer_base %}

{% block script_base %}
    <script type="text/javascript" src="{% static "js/bootstrap.min.js" %}"></script>
    <script type="text/javascript">
      var app = new Vue({
        name: 'contents_dashboard',
        data: {
          lists: { my_lps: {label: 'My LPs', els: [{ list: '', obj_type: 'lp', obj_id: 0, label: 'empty', url: '#', index: 0, }], selected: null}, personal_lps: {label: 'Personal LPs', els: [{ list: '', obj_id: 0, obj_type: 'lp', label: 'empty', url: '#', index: 0, }], selected: null}, my_oers: {label: 'My OERs', els: [{ list: '', obj_id: 0, obj_type: 'oer', label: 'empty', url: '#', index: 0, }], selected: null}, personal_oers: {label: 'Personal OERs', els: [{ list: '', obj_id: 0, obj_type: 'oer', label: 'empty', url: '#', index: 0, }], selected: null} },
          corpus: {label: 'Corpus', els: [{ list: '', obj_id: 0, obj_type: '', label: 'empty', url: '#', index: 0, }], selected: null},
          list: {label: '', els: [{ list: '', obj_id: 0, obj_type: '', label: 'empty', url: '#', index: 0, }], selected: null},
          selected: null,
          index: 0,
          result: '',
		},
        el: '#app',
        components: {
          // 'vddl-draggable': window.httpVueLoader("http://localhost:8000/static/yarn/vddl/src/components/vddl-draggable.vue"),
          // 'vddl-list': window.httpVueLoader("http://localhost:8000/static/yarn/vddl/src/components/vddl-list.vue")
        },
        methods: {
          selectedEvent: function(item){
            console.log(':v-draggable: dragstart');
            // this.selected = item;
            var key = item.list
            this.lists[key].selected = item;
          },
          handleDragstart() {
            console.log(':v-draggable: dragstart');
          },
          handleDragend() {
            console.log(':v-draggable: dragend');
          },
          handleCanceled() {
            console.log(':v-draggable: canceled');
          },
          handleMoved(item) {
            console.log(':v-draggable: moved');
            console.log(item);
            const { index, list } = item;
            list.splice(index, 1);
          },
          handleDragover() {
            console.log(':v-list: handleDragover');
          },
          handleInserted() {
            console.log(':v-list: inserted');
          },
          handleDrop(data) {
            console.log(':v-list: drop');
            console.log(data);
            const { index, list, item } = data;
            // change the id
            item.id = new Date().getTime();
            list.splice(index, 0, item);
          },
          compareSelected() {
            console.log('compareSelected');
            fetch('/ajax_compare_resources/', {
              method: 'POST',
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify(app.corpus)
           	})
            .then(response => response.json())
            .then(data => (this['result'] = data['result']))
            .catch(err => (this['result'] = err))
          }
        },
        mounted: function () {
          this['corpus']['els'] = [];
          fetch('/contents_dashboard/', {
            method: 'GET',
            headers: {"X-Requested-With": "XMLHttpRequest"}, // this is just a patch
          })
          .then(response => response.json())
          .then(data => {
	        console.log(Object.entries(data).length);
            // set all properties from response data into app data
            for (var key in data) {
          		list = this['lists'][key]
          		list['els'] = data[key];
          		var index = 0;
          		for (var el in this['lists'][key]['els']) {
              		el['list'] = key;
              		el['selected'] = false;
              		el['index'] = index;
              		index += 1;
          		}
          	}
          })
          .catch(err => (console.log('err')))
        },
        updated: function () {
        },
      });
      
      $(document).ready(function (){
        $('div a.toggleIcon').on('click', function(event){
            event.preventDefault();
            $("body").css("cursor", "default");
            var accordion = $(this).parent();
            var accordionContent = accordion.next('div');
            var accordionToggleIcon = $(this);
            accordion.toggleClass("open");
            accordionContent.slideToggle(250);
            if (accordion.hasClass("open")) {
                accordionToggleIcon.children('i').attr("class","fa fa-minus-square");
            } else {
                accordionToggleIcon.children('i').attr("class","fa fa-plus-square");
            }
        });
      });
	</script>
{% endblock script_base %}
