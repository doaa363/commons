{% extends "commons_base.html" %}
{% load staticfiles i18n %}

{% block head_title %}OER: {{ oer.title }}{% endblock %}

{% block body_class %}oer_detail{% endblock %}

{% block body %}
<article class="panel-white text-left marginTB30">
  <div class="navbar panel-c2 panel-heading-c2 padding1020">
    <h2 class="pull-left marginTB5">{{ oer.title }}</h2>
    <p class="pull-right marginB0 font26">
      {% if can_edit %}&nbsp; <a href="/oer/{{ oer.slug }}/edit/" title="{% trans "show edit view" %}"><i class="fa fa-edit font07em c-white"></i></a>{% endif %}
      {% if can_evaluate %}&nbsp; <a href="/oer/{{ oer.slug }}/evaluate/" title="{% trans "evaluate" %}"><i class="fa fa-star-o font07em c-white"></i></a>{% endif %}
      {% if add_bookmarked and not in_bookmarked_oers %}&nbsp; <a href="/oer/{{ oer.slug }}/?copy=true" title="{% trans "bookmark this OER for future reference" %}"><i class="fa fa-bookmark-o font07em c-white"></i></a>{% endif %}
      {% if can_delete and not in_cut_oers %}&nbsp; <a href="/oer/{{ oer.slug }}/?cut=true" title="{% trans "mark this OER as a candidate for cut & paste" %}"><i class="fa fa-cut font07em c-white"></i></a>{% endif %}
    </p>
  </div>
  <section class="view-card-details">
    <div class="row">
      <div class="col-sm-9 col-md-9 col-lg-9">
      <div class="marginB10 clearfix">
      {% if oer.url and oer.description %}
        <div class="hidden-xs">
           <div class="posRel">
              <div class="bg_view floatL"><a href="/oer/{{ oer.slug }}/view/" class="btn btn-c2" title="{% trans "view resource" %}: {{ oer.url }}">{% trans "view resource" %}</a></div>
              <p>{{ oer.description }}</p>
           </div>
        </div>
        <div class="visible-xs">
           <p class="bg_view"><a href="/oer/{{ oer.slug }}/view/" class="btn btn-c2" title="{% trans "view resource" %}: {{ oer.url }}">{% trans "view resource" %}</a></p>
           <p>{{ oer.description }}</p>
        </div>
      {% elif oer.description %}
        <p>{{ oer.description }}</p>
      {% endif %}
      {% if oer.material %}
        {% include "_data.html" with data=oer.material data_class=" font14" label_data="type of material" action="/oers/search/" type_data="material" %}
      {% endif %}
      {% if oer.license %}
        {% include "_data.html" with data=oer.license data_class=" font14" label_data="terms of use" action="/oers/search/" type_data="license" %}
      {% endif %}
      {% if oer.reference or oer.embed_code %}
        <dl class="list-inline font14">
           {% if oer.reference %}
              <dt class="with_icon">{% trans "reference info"|capfirst %} <a href="#" class="toggleIcon"><i class="fa fa-plus-circle"></i></a></dt>
              <dd class="field-content width-full" style="display:none"><pre class="borderRadius0 bc-white">{{ oer.reference }}</pre></dd>
           {% endif %}
           {% if oer.embed_code %}
              <dt class="with_icon">{% trans "embed code"|capfirst %} <a href="#" class="toggleIcon"><i class="fa fa-plus-circle"></i></a></dt>
              <dd class="field-content" style="display:none"><pre class="borderRadius0 bc-white">{{ oer.embed_code }}</pre></dd>
           {% endif %}
        </dl>
      {% endif %}
      </div>

      {% if oer.levels.all %}
        {% include "_data_all.html" with data=oer.levels.all data_class=" font14  marginB10" label_data="target audience" action="/oers/search/" type_data="levels" %}
      {% endif %}

      {% if oer.subjects.all and oer.tags.all %}
        <div class="row">
           <div class="col-sm-6 col-md-6 col-lg-6 paddingB10 paddingR0">
             {% include "_data_all.html" with data=oer.subjects.all data_class=" font14" label_data="subject areas" action="/oers/search/" type_data="subjects" %}
           </div>
           <div class="col-sm-6 col-md-6 col-lg-6 paddingB10 ">
             {% include "_data_all.html" with data=oer.tags.all data_class=" font14" label_data="tags" action="/oers/search/" type_data="tags" %}
           </div>
        </div>
      {% elif oer.subjects.all %}
        {% include "_data_all.html" with data=oer.subjects.all data_class=" font14 marginB10" label_data="subject areas" action="/oers/search/" type_data="subjects" %}
      {% elif oer.tags.all %}
        {% include "_data_all.html" with data=oer.tags.all data_class=" font14 marginB10" label_data="tags" action="/oers/search/" type_data="tags" %}
      {% endif %}

      <div class="marginB10">
         {% if oer.languages.all %}
           {% include "_data_languages.html" with data=oer.languages.all data_class=" font14" action="/oers/search/" %}
         {% endif %}
         {% if oer.media.all %}
           {% include "_data_all.html" with data=oer.media.all data_class=" font14" label_data="media formats" action="/oers/search/" type_data="media" %}
         {% endif %}
         {% if oer.accessibility.all %}
           {% include "_data_all.html" with data=oer.accessibility.all data_class=" font14" label_data="accessibility features" action="/oers/search/" type_data="accessibility" %}
         {% endif %}
      </div>

      {% if oer.get_more_metadata %}
        <dl class="font14 marginB10">
           <dt class="demiBold">{% trans "other metadata"|capfirst %}</dt>
           {% for metadatum in oer.get_more_metadata %}
             <dd><i>{{ metadatum.metadata_type.name }}</i>: {{ metadatum.value }}</dd>
           {% endfor %}
        </dl>
      {% endif %}

      <dl class="list-inline font14 marginB10">
         <dt>{% trans "OER type"|capfirst %}</dt>
         <dd>{{ type }}</dd>
      </dl>
      
      {% if oer.oers.all %}
          <dl class="list-inline font14 marginB10">
            <dt>{% trans "derived from"|capfirst %}</dt>
            {% for item in oer.oers.all %}
              <dd><a href="/oer/{{ item.slug }}">{{ item.title }}</a></dd>
            {% endfor %}
          </dl>
      {% endif %}
      {% if oer.translated %}
        <p>tradotto</p>
      {% endif %}
      {% if oer.remixed %}
        <p>adattato</p>
      {% endif %}

      {% if oer.source %}
        {% include "_data.html" with data=oer.source data_class=" font14 marginB10" label_data="source repository" action="/repo/"|add:oer.source.slug|add:"/" type_data="source_repository" %}
      {% endif %}

      {% if oer.documents.all %}
        <dl class="font14 marginB10">
           <dt class="demiBold">{% trans "attached documents"|capfirst %}</dt>
           {% for document in oer.get_sorted_documents %}
             <dd>
               {% if can_edit %}<a class="deleteDoc" id="u_{{ document.id }}" href="#" title="{% trans "delete" %}"><i class="fa fa-times-circle red"></i></a> &nbsp;
                 {% if oer.get_sorted_documents|length > 1 %}
                   <span class="font12">
                     {% if not forloop.first and not forloop.last %}<a class="upDoc" id="u_{{ document.id }}" href="#" title="{% trans "move up" %}"><i class="fa fa-arrow-up"></i></a> &nbsp; <a class="downDoc" id="u_{{ document.id }}" href="#" title="{% trans "move down" %}"><i class="fa fa-arrow-down"></i></a> &nbsp;
                     {% elif forloop.first %}<i class="fa fa-arrow-up c-white"></i> &nbsp; <a class="downDoc" id="u_{{ document.id }}" href="#" title="{% trans "move down" %}"><i class="fa fa-arrow-down"></i></a> &nbsp;
                     {% elif forloop.last %}<a class="upDoc" id="u_{{ document.id }}" href="#" title="{% trans "move up" %}"><i class="fa fa-arrow-up"></i></a> &nbsp; <i class="fa fa-arrow-down c-white"></i> &nbsp;
                     {% endif %}
                   </span>
                 {% endif %}
               {% endif %}
               {{ document.label }} 
               &nbsp;&nbsp;<a href="/document/{{ document.id }}/download/" title="{% trans "download" %}"><i class="fa fa-download"></i></a>
               {% if document.viewable %}&nbsp;&nbsp;&nbsp;<a href="/document/{{ document.id }}/view/" title="{% trans "view" %}"><i class="fa fa-eye"></i></a>{% endif %}
             </dd>
           {% endfor %}
        </dl>
      {% endif %}
      {% comment %}{% if oer.oer_type == 3 and can_edit %}{% endcomment %}
      {% if can_edit %}
        <dl class="font14 marginB10">
           <dt class="demiBold">{% trans "add document"|capfirst %}</dt>
           <dd><form enctype="multipart/form-data" method="post" id="add_document" action="/oer/add_document/">{% csrf_token %}
               <input type="hidden" id="id" name="id" value="{{ oer.id }}">
               <div>{{ form.non_field_errors }}</div>
               <div class="marginB10"><span class="red">{{ form.docfile.errors }}</span>{{ form.docfile }}</div>
               <div class="marginB10"><button type="submit" id="add" name="add" class="btn btn-default" value='{% trans "add"|capfirst %}'>{% trans "add"|capfirst %}</button>
                  {% if form.docfile.errors %}&nbsp; <button type="submit" name="cancel" id="cancel" value="cancel" class="btn btn-default">{% trans "cancel"|capfirst %}</button>{% endif %}
               </div>
               </form></dd>
        </dl>
      {% endif %}
      </div>
      <div class="col-sm-3 col-md-3 col-lg-3">
        <p><span class="demiBold">{% trans "submitted by"|capfirst %}:</span> <a href="/resources_by/{{ oer.creator.username }}">{{ oer.creator.get_full_name }}</a><br>
           <span class="demiBold">{% trans "on" %}:</span> {{ oer.created|date:"d/m/Y" }} <br>
           <span class="demiBold">{% trans "in project" %}:</span> <i class="fa fa-group c-grey"></i> <a href="/project/{{ oer.project.slug }}/">{{ oer.project }}</a>
        </p>
        {% if user.is_authenticated %}
          {% if not is_published %}<div class="marginB5"><span class="demiBold">{% trans "publication state"|capfirst %}</span>: <span style="color: {{ oer.get_title_color }};">{{ oer.get_state }}</span></div>{% endif %}
          {% if can_submit or can_withdraw or can_reject or can_publish or can_un_publish %}
            {% if is_published %}<div class="marginB5"><span class="demiBold">{% trans "publication state"|capfirst %}</span>: <span style="color: {{ oer.get_title_color }};">{{ oer.get_state }}</span></div>{% endif %}
            <ul class="list-inline">
                {% if can_submit %}<li class="marginB5"><a href="/oer/{{ oer.id }}/submit/" title="{% trans "submit for publication" %}" class="btn btn-default"><i class="fa fa-mail-forward font07em"></i> {% trans "submit for publication" %}</a></li>{% endif %}
                {% if can_withdraw %}<li class="marginB5"><a href="/oer/{{ oer.id }}/withdraw/" title="{% trans "withdraw" %}" class="btn btn-default"><i class="fa fa-reply font07em"></i> {% trans "withdraw" %}</li></a>{% endif %}
                {% if can_reject %}<li class="marginB5"><a href="/oer/{{ oer.id }}/reject/" title="{% trans "reject" %}" class="btn btn-default"><i class="fa fa-reply font07em"></i> {% trans "reject" %}</a></li>{% endif %}
                {% if can_publish %}<li class="marginB5"><a href="/oer/{{ oer.id }}/publish/" title="{% trans "publish" %}" class="btn btn-default"><i class="fa fa-check font07em"></i> {% trans "publish" %}</a></li>{% endif %}
                {% if can_un_publish %}<li class="marginB5"><a href="/oer/{{ oer.id }}/un_publish/" title="{% trans "unpublish" %}" class="btn btn-default"><i class="fa fa-lock font07em"></i> {% trans "unpublish" %}</a></li>{% endif %}
            </ul>
          {% endif %}
        {% endif %}
        <p><span class="demiBold">{% trans "last updated"|capfirst %}</span> {% if not oer.editor.id = oer.creator.id %} <span class="demiBold">{% trans "by" %}:</span> <a href="/resources_by/{{ oer.editor.username }}">{{ oer.editor.get_full_name }}</a>{% endif %} <span class="demiBold">{% trans "on" %}:</span> {{ oer.modified|date:"d/m/Y" }}</p>
        {% if is_published %}
          <dl class="font14 marginB10">
            <dt class="demiBold">{% trans "evaluations"|capfirst %}</dt>
            {% with stars=oer.get_stars %}<dd>{% include "_view_rating.html" %}</dd>{% endwith %}
            {% if evaluations %}
              {% for evaluation in evaluations %}
                <dd><a href="/resources_by/{{ evaluation.user.username }}">{{ evaluation.user.get_display_name }}</a>: <a href="/oer_evaluation/{{ evaluation.id }}/" title="{{ evaluation.review|truncatechars:100 }}">
                    <strong>{{ evaluation.overall_score }}</strong>/5 <small><i class="fa fa-star-o"></i></small></a>
                    {% if evaluation.get_quality_metadata %}
                      <small> ({% for qm in evaluation.get_quality_metadata %}{{ qm.quality_facet }}:
                       {{ qm.value }}/5{% if not forloop.last %}, {% endif %}{% endfor %})</small>
                    {% endif %}
                </dd>
              {% endfor %}
            {% endif %}
          </dl>
        {% endif %}
      </div>
    </div>
  </section>
</article>
{% endblock %}

{% block extra_script %}
<script type="text/javascript">
$(document).ready(function (){
	$('dt a.toggleIcon').on('click', function(event){
		event.preventDefault();
		var accordion = $(this).parent();
		var accordionContent = accordion.next('.field-content');
		var accordionToggleIcon = $(this);
		accordion.toggleClass("open");
		accordionContent.slideToggle(250);
		if (accordion.hasClass("open")) {
			accordionToggleIcon.children('i').attr("class","fa fa-minus-circle");
		} else {
			accordionToggleIcon.children('i').attr("class","fa fa-plus-circle");
		}
	});


	if ($('dd a').hasClass('deleteDoc')) {
		$('dd a.deleteDoc').on('click', function(event){
			event.preventDefault();
			var node_id = $(this).attr('id');
			doc_id = node_id.substr(2);
			$.ajax({
				url: "/document/"+doc_id+"/delete/",
				success: function(json){
					if (json.data == 'ok')
						location.reload();
				}
			});
		});
	}

	if ($('dd span a').hasClass('upDoc')) {
		$('dd span a.upDoc').on('click', function(event){
			event.preventDefault();
			var doc_id = $(this).attr('id');
			doc_id = doc_id.substr(2);
			$.ajax({
				url: "/document/"+doc_id+"/up/",
				success: function(json){
					if (json.data == 'ok')
						location.reload();
				}
			});
		});
	}
	if ($('dd span a').hasClass('downDoc')) {
		$('dd span a.downDoc').on('click', function(event){
			event.preventDefault();
			var doc_id = $(this).attr('id');
			doc_id = doc_id.substr(2);
			$.ajax({
				url: "/document/"+doc_id+"/down/",
				success: function(json){
					if (json.data == 'ok')
						location.reload();
				}
			});
		});
	}

});
</script>
{% endblock %}