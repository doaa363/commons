{% extends "commons_base.html" %}

{% load staticfiles i18n %}

{% block head_title %}{% trans "learning path"|capfirst %}: {{ lp.title }}{% endblock %}

{% block languages %}{% include "_hreflang.html" %}{% endblock %}
  {% block extra_style %}
  <link rel="stylesheet" href="{% static 'commons/css/jquery-ui.min.css' %}">
<style>
/*div.boxNode {
	border:2px solid #ccc;
	border-radius: 4px;
	background: #f1f2f2;
	position:absolute;
	top:0;
	width:100%;
	height:400px;
	box-shadow: 5px 5px 5px 0px rgba(0,0,0,0.25);
	z-index:999;
}
div.boxNode div {
  background:#999;
  margin:-2px -2px 0 -2px;
  padding:5px 10px;
  border:2px solid #999;
  border-bottom-width:0;
	border-top-left-radius: 4px;
	border-top-right-radius: 4px;
}
a.boxClose {
	color:#eee;
	text-decoration: none
}
a.boxClose:hover,.boxClose.focus {
	color:white;
}
*/
iframe {
 width: 100%;
 /*height: 350px;*/
 border:0;
}
#dag {
	width:100%;
	min-height:300px;
	overflow:auto;
	border:1px solid #ccc;
	margin-top: 5px;
  margin-bottom: 10px;
  padding:10px;
}
.ui-widget-overlay {
	background: #444444;
	opacity: .7;
	filter: Alpha(Opacity=70); /* support: IE8 */
}
.ui-dialog {
	z-index: 1050;
}
</style>
{% endblock %}
{% block body_class %}lp_detail{% endblock %}
{% block body %}
{% include "_resource_lang_msg.html" %}
<article class="panel-white text-left marginTB30">
    {% if can_less_action %}
    <div class="row panel-c1 panel-heading-c1 marginLR0 padding1020">
      <h2 class="col-sm-8 col-md-9 col-lg-9 marginTB5 paddingL0">{% if can_remove %}<form class="view_inline" action="/lp/{{ lp.id }}/delete/" method="post" onsubmit="return confirm_delete(this);" id="delete_{{ lp.id }}">{% csrf_token %}<input type="hidden" name="user" value="{{ u.0.username }}"><button type="submit" class="btn-link" title="{% trans "delete" %}" id="submit_{{ lp.id }}"><i class="fa fa-times-circle font07em c-white"></i></button></form> {% endif %}{{ lp.title }}</h2></h2>
      <p class="col-sm-4 col-md-3 col-lg-3 marginB0 font26 text-right paddingL0">
        {% if can_edit and not language_mismatch %}&nbsp; <a href="/lp/{{ lp.slug }}/edit/" title="{% trans "show edit view" %}"><i class="fa fa-edit font07em c-white"></i></a>{% endif %}
        {% if can_translate and object.original_language %}&nbsp; <a href="/datatrans/translate/learningpath/{{ object.pk }}/" title="{% trans "show translate view" %}"><i class="fa fa-language font07em c-white"></i></a>{% endif %}
        {% if add_bookmarked and not in_bookmarked_lps %}&nbsp; <a href="/lp/{{ lp.slug }}/?copy=true" title="{% trans "bookmark this LP for future reference" %}"><i class="fa fa-bookmark-o font07em c-white"></i></a>{% endif %}
        {% if can_delete and not in_cut_lps %}&nbsp; <a href="/lp/{{ lp.slug }}/?cut=true" title="{% trans "mark this LP as a candidate for cut & paste" %}"><i class="fa fa-cut font07em c-white"></i></a>{% endif %}
      </p>
    </div>
  {% else %}
    <div class="panel-c1 panel-heading-c1 padding1020"><h2 class="marginTB5">{{ lp.title }}</h2></div>
  {% endif %}
  <section class="view-card-details">
    <div class="row">
      <div class="col-sm-9 col-md-9 col-lg-9">
        <div class="marginB10 clearfix">
          {% if can_play %}
            <div class="hidden-xs">
              <div class="posRel">
                <div class="bg_play floatL"><a href="/lp/{{ lp.slug }}/play/?node=0" title="{% trans "show player view" %}"><i class="fa fa-youtube-play"></i></a></div>
                <dl class="list-inline font14 marginB10">
                  <dt>{% trans "objectives"|capfirst %}</dt>
                  <dd>{{ lp.short|safe }}</dd>
                </dl>
                {% if lp.levels.all %}
                  {% include "_data_all.html" with data=lp.levels.all data_class=" font14  marginB10" label_data="target audience" action="/lp/search/" type_data="levels" %}
                {% endif %}
                {% if lp.subjects.all and lp.tags.all %}
                  {% include "_data_all.html" with data=lp.subjects.all data_class=" font14" label_data="subject areas" action="/lps/search/" type_data="subjects" %}
                  {% include "_data_all.html" with data=lp.tags.all data_class=" font14" label_data="tags" action="/lps/search/" type_data="tags" %}
                {% elif lp.subjects.all %}
                  {% include "_data_all.html" with data=lp.subjects.all data_class=" font14 marginB10" label_data="subject areas" action="/lps/search/" type_data="subjects" %}
                {% elif lp.tags.all %}
                  {% include "_data_all.html" with data=lp.tags.all data_class=" font14 marginB10" label_data="tags" action="/lps/search/" type_data="tags" %}
                {% endif %}
              </div>
            </div>
            <div class="visible-xs">
              <p class="bg_play"><a href="/lp/{{ lp.slug }}/play/" title="{% trans "show player view" %}"><i class="fa fa-youtube-play"></i></a></p>
              <dl class="list-inline font14 marginB10">
                <dt>{% trans "objectives"|capfirst %}</dt>
                <dd>{{ lp.short|safe }}</dd>
              </dl>
              {% if lp.levels.all %}
                {% include "_data_all.html" with data=lp.levels.all data_class=" font14  marginB10" label_data="target audience" action="/lp/search/" type_data="levels" %}
              {% endif %}
              {% if lp.subjects.all and lp.tags.all %}
                <div class="row">
                  <div class="col-sm-6 col-md-6 col-lg-6  paddingB10 paddingR0">
                    {% include "_data_all.html" with data=lp.subjects.all data_class=" font14" label_data="subject areas" action="/lps/search/" type_data="subjects" %}
                  </div>
                  <div class="col-sm-6 col-md-6 col-lg-6  paddingB10">
                    {% include "_data_all.html" with data=lp.tags.all data_class=" font14" label_data="tags" action="/lps/search/" type_data="tags" %}
                  </div>
                </div>
                {% elif lp.subjects.all %}
                  {% include "_data_all.html" with data=lp.subjects.all data_class=" font14 marginB10" label_data="subject areas" action="/lps/search/" type_data="subjects" %}
                {% elif lp.tags.all %}
                  {% include "_data_all.html" with data=lp.tags.all data_class=" font14 marginB10" label_data="tags" action="/lps/search/" type_data="tags" %}
                {% endif %}
            </div>
          {% else %}
            <dl class="list-inline font14 marginB10">
              <dt>{% trans "objectives"|capfirst %}</dt>
              <dd>{{ lp.short|safe }}</dd>
            </dl>
            {% if lp.levels.all %}
              {% include "_data_all.html" with data=lp.levels.all data_class=" font14  marginB10" label_data="target audience" action="/lp/search/" type_data="levels" %}
            {% endif %}
            {% if lp.subjects.all and lp.tags.all %}
              <div class="row">
                <div class="col-sm-6 col-md-6 col-lg-6  paddingB10 paddingR0">
                  {% include "_data_all.html" with data=lp.subjects.all data_class=" font14" label_data="subject areas" action="/lps/search/" type_data="subjects" %}
                </div>
                <div class="col-sm-6 col-md-6 col-lg-6  paddingB10">
                  {% include "_data_all.html" with data=lp.tags.all data_class=" font14" label_data="tags" action="/lps/search/" type_data="tags" %}
                </div>
              </div>
            {% elif lp.subjects.all %}
              {% include "_data_all.html" with data=lp.subjects.all data_class=" font14 marginB10" label_data="subject areas" action="/lps/search/" type_data="subjects" %}
            {% elif lp.tags.all %}
              {% include "_data_all.html" with data=lp.tags.all data_class=" font14 marginB10" label_data="tags" action="/lps/search/" type_data="tags" %}
            {% endif %}
          {% endif %}
        </div>
        {% if lp.long %}
          <dl class="list-inline font14 marginB10 clearfix">
            <dt class="with_icon">{% trans "description"|capfirst %} <a href="#" class="toggleIcon"><i class="fa fa-plus-circle"></i></a></dt>
            <dd class="field-content width-full" style="display:none"><blockquote class="font14">{{ lp.long|safe }}</blockquote></dd>
          </dl>
        {% endif %}

        <dl class="list-inline font14 ">
          <dt>{% trans "type of learning path"|capfirst %}</dt> 
          <dd>{% comment %}<form action="/lps/search/" method="post" id="path_type">{% csrf_token %}<button type="submit" class="btn-link" value="{{ lp.path_type }}">{{ lp.get_type }}</button></form>{% endcomment %}{{ lp.get_type }}
            {% if can_make_sequence %}
            &nbsp; <a href="/lp/{{ lp.id }}/make_sequence/" title="{% trans "convert to sequence type" %}"><i class="fa fa-chain font07"></i></a>
            {% endif %}
            {% if can_make_collection %}
            &nbsp;&nbsp; <form class="view_inline" action="/lp/{{ lp.id }}/make_collection/" method="post" onsubmit="return confirm_convert(this);" id="convert_{{ lp.id }}">{% csrf_token %}<button type="submit" class="btn-link" title="{% trans "convert to simple collection" %}" id="submit_{{ lp.id }}"><i class="fa fa-ellipsis-h font07"></i></button></form>
            {% endif %}
            {% comment %}&nbsp;&nbsp; <form class="view_inline" action="/lp/{{ lp.id }}/make_linear_dag/" method="post" onsubmit="return confirm_convert(this);" id="convert_{{ lp.id }}">{% csrf_token %}<button type="submit" class="btn-link" title="{% trans "convert to graph type" %} {% trans "keeping the linear ordering" %}" id="submit_{{ lp.id }}"><i class="fa fa-long-arrow-down font07" style="font-weight: bold;"></i></button></form>{% endcomment %}
            {% if can_make_dag %}
            &nbsp;&nbsp; <form class="view_inline" action="/lp/{{ lp.id }}/make_tree_dag/" method="post" onsubmit="return confirm_convert(this);" id="convert_{{ lp.id }}">{% csrf_token %}<button type="submit" class="btn-link" title="{% trans "convert to graph type" %} {% trans "in tree form" %}: {% trans "suggested only for few nodes" %}!" id="submit_{{ lp.id }}"><i class="fa fa-sitemap font07"></i></button></form>
            {% endif %}
            {% if can_make_unconnected_dag %}
            &nbsp;&nbsp; <form class="view_inline" action="/lp/{{ lp.id }}/make_unconnected_dag/" method="post" onsubmit="return confirm_convert(this);" id="convert_{{ lp.id }}">{% csrf_token %}<button type="submit" class="btn-link" title="{% trans "convert to graph type" %} {% trans "with unconnected nodes" %}" id="submit_{{ lp.id }}"><i class="fa fa-ellipsis-v font07" style="font-weight: bold;"></i></button></form>
            {% endif %}
          </dd>
        </dl>

        {% if lp.get_nodes or can_edit %}
          <dl style="position:relative" class="font14 marginB10">
            <dt class="demiBold">{% trans "path nodes"|capfirst %}</dt>
            {% if lp.path_type == 3 %}
              {% if lp.get_nodes %}
                <dd id="dag"></dd>
              {% endif %}
            {% else %}
            <dd>{% if lp.path_type == 2 %}<ol class="paddingL24">{% else %}<ul class="list-unstyled">{% endif %}
              {% for node in lp.get_ordered_nodes %}
                <li class="marginB5">
                  <div class="paddingL3">
                  	<ul class="list-unstyled {% if node.oer_id %}node-oer{% else %}node-text{% endif %}" style="padding-left:24px;"><li>
                  	{% comment %} /pathnode/{{ node.id }}/delete/ {% endcomment %}
                    {% if can_edit %}<a class="deleteNode" id="r_{{ node.id }}" href="#" title="{% trans "delete" %}"><i class="fa fa-times-circle red"></i></a> &nbsp;
                      {% if lp.get_ordered_nodes|length > 1 %}
                        {% if not node.is_island %} 
                          <span class="font12">
                            {% if not node.is_root and not node.is_leaf %}<a class="upNode" id="u_{{ node.id }}" href="#" title="{% trans "move up" %}"><i class="fa fa-arrow-up"></i></a> &nbsp; <a class="downNode" id="d_{{ node.id }}" href="#" title="{% trans "move down" %}"><i class="fa fa-arrow-down"></i></a> &nbsp;
                            {% elif node.is_root %}<i class="fa fa-arrow-up c-white"></i> &nbsp; <a class="downNode" id="d_{{ node.id }}" href="#" title="{% trans "move down" %}"><i class="fa fa-arrow-down"></i></a> &nbsp;
                            {% elif node.is_leaf %}<a class="upNode" id="u_{{ node.id }}" href="#" title="{% trans "move up" %}"><i class="fa fa-arrow-up"></i></a> &nbsp; <i class="fa fa-arrow-down c-white"></i> &nbsp;
                            {% endif %}
                          </span>
                        {% endif %}
                      {% endif %}
                    {% endif %}
                    {# /pathnode/{{ node.id }}/?node={{forloop.counter0}} #}
                      <a class="viewNode" id="u_{{ node.id }}" href="/pathnode/{{node.id}}/" title="">{{ node.label }}</a>
                    </li></ul>
                  </div>
                </li>
              {% endfor %}
              {% if lp.path_type == 2 %}</ol>{% else %}</ul>{% endif %}
            </dd>
            {% endif %}
            {% comment %}
            {% if lp.get_nodes %}
              <div id="showNode" class="boxNode" style="display:none">
                <div class="text-right" ><a class="boxClose" href="#">{% trans "close" %}</a></div>
                <iframe id="iframeNode" src=""></iframe>
              </div>
            {% endif %}
            {% endcomment %}
            {% if can_edit and lp.original_language and not language_mismatch %}
              <dd class="marginT10"><a href="/lp/{{ lp.slug }}/pathnode_new/" class="btn btn-default">{% trans "add node"|capfirst %}</a></dd>
              {% if bookmarked_oers %}{% for oer in bookmarked_oers %}
                <dd class="marginT5"><a id="{{ oer.id }}" href="/lp/{{ lp.slug }}/pathnode_add/{{ oer.id }}/" class="btn btn-default add_node_oer">{% trans "add node with OER"|capfirst %}: <span class="demiBold">{{ oer.title|truncatewords:5 }}</span></a></dd>
              {% endfor %}{% endif %}
            {% endif %}
          </dl>
        {% endif %}
      </div>
      <div class="col-sm-3 col-md-3 col-lg-3">
        {% include "_info_creator_date.html" with data=lp %}
        {% include "_resource_original_lang.html" %}
        {% include "_change_state.html" with data=lp type_object="lp" %}
      </div>
    </div>
    {% if project %}
      {% include "_object_comments.html" with data_class="c1" data_obj=lp type_obj="lp" %}
    {% endif %}
  </section> 
</article>
{% endblock %}

{% block extra_script %}
<script src="{% static 'commons/js/jquery-ui.min.js' %}"></script>
<script src="{% static 'commons/js/jquery.dialogOptions.js' %}"></script>

<script type="text/javascript">
  {% if can_delete %}
    function confirm_delete(form) {
      return confirm('{% trans "do you really want to delete" %} {% trans "this learning path" %}?');
    }
  {% endif %}
  function confirm_convert(form) {
    return confirm('{% trans "do you really want to convert" %} {% trans "this learning path" %}?{% comment %}{% trans "this operation cannot be undone" %}{% endcomment %}');
  }
  $(document).ready(function() {

		$('dt a.toggleIcon').on('click', function(event){
			event.preventDefault();
			var accordion = $(this).parent();
			var accordionContent = accordion.next('.field-content');
			var accordionToggleIcon = $(this);
			accordion.toggleClass("open");
			accordionContent.slideToggle(250);
			if (accordion.hasClass("open")) {
				accordionToggleIcon.children('i').attr("class","fa fa-minus-circle");
			} else {
				accordionToggleIcon.children('i').attr("class","fa fa-plus-circle");
			}
		});
/*
		if ($('li div a').hasClass('viewNode')) {
			$('li div a.viewNode').on('click', function(event){
				event.preventDefault();
				var node_id = $(this).attr('id');
				node_id = node_id.substr(2);
				$('#popup').load("/pathnode/"+node_id+"/").dialog({modal: true}).dialog('open')
				/*
				$.ajax({
					url: "/pathnode/"+node_id+"/",
					success: function(json){
						if (json.data == 'OK') {
						   $('#iframeNode').attr('src','/pathnode/'+json.node+'/');
						   $('#showNode').css('display','block');
						}
					}
				});
			});
		}
		
		if ($('div.boxNode div a').hasClass('boxClose')) {
			$("#showNode div a.boxClose").on('click', function(event){
				event.preventDefault();
				$('#showNode').css('display','none');
				$('#iframeNode').attr('src','');
			});
		}
*/
		
		if ($('li div a').hasClass('deleteNode')) {
			$('li div a.deleteNode').on('click', function(event){
				event.preventDefault();
				var node_id = $(this).attr('id');
				node_id = node_id.substr(2);
				$.ajax({
					url: "/pathnode/"+node_id+"/delete/",
					success: function(json){
						if (json.data == 'ok')
							location.reload();
					}
				});
			});
		}
		if ($('li div a').hasClass('upNode')) {
			$('li div a.upNode').on('click', function(event){
				event.preventDefault();
				var node_id = $(this).attr('id');
				node_id = node_id.substr(2);
				$.ajax({
					url: "/pathnode/"+node_id+"/up/",
					success: function(json){
						if (json.data == 'ok')
							location.reload();
					}
				});
			});
		}
		if ($('li div a').hasClass('downNode')) {
			$('li div a.downNode').on('click', function(event){
				event.preventDefault();
				var node_id = $(this).attr('id');
				node_id = node_id.substr(2);
				$.ajax({
					url: "/pathnode/"+node_id+"/down/",
					success: function(json){
						if (json.data == 'ok')
							location.reload();
					}
				});
			});
		}
    if ($('li a').hasClass('viewNode')) {
      $('li a.viewNode').on('click', function(event){
         event.preventDefault();
         $('<div/>',{
           'id':'link-'+($(this).index()+1)})
         .html($('<iframe/>', {
           'src': $(this).attr('href'),
           'style': 'width:100%; height:90%'}))
         .appendTo('body')
         .dialog({
           'width': 800,
           'height': 450,
           modal: true,
           responsive: true,
           clickOut: true,
         });
      });
    }
	});
</script>

{% if lp.path_type == 3 %}{% include "_lp_dag.html" %}{% endif %}

{% endblock %}