{% extends "commons_base.html" %}

{% load i18n %}
{% if project.has_chat_room and can_chat %}
	{% load static from staticfiles %}
	{% load conversejs %}
	{% comment %}{% load dmuc %}{% endcomment %}
{% endif %}

{% block head_title %}{% if project.proj_type.name = 'com' %}{% trans "community"|capfirst %}{% else %}{% trans "project"|capfirst %}{% endif %}: {{ project.get_name }}{% endblock %}

{% block extra_head %}
	{% if project.has_chat_room and can_chat %}
{% comment %}<link rel="stylesheet" href="{% static 'css/style.css' %}" type="text/css" media="screen, projection" />{% endcomment %}
<link rel="stylesheet" href="{% static 'converse.js/converse.min.css' %}" type="text/css" media="screen, projection" />
<script>var room_label='{{ room_label }}';</script>
<script type="text/javascript" src="{% static 'converse.js/converse.min.js' %}"></script>
<script>window.scrollTo(0, 2000);</script>
	{% endif %}
{% if can_delegate %}
	<script>
	function confirm_delegate(form) {return confirm('{% trans "do you really want to grant the admin or supervisor role to this member" %}?');}
	</script>
	<script>
	function confirm_undelegate(form) {return confirm('{% trans "do you really want to call back the admin or supervisor role from this member" %}?');}
	</script>
{% endif %}
{% endblock %}

{% block body %}
    {% for message in messages %}
    <div class="alert alert-{{ message.tags }}">{{ message }}</div>
    {% endfor %}
<div class="row">
  <div class="col-sm-3" style="margin-top: 4.0em;">
  		 {% if project.group.level > 0 %}
   			<h4>{% trans "members"|capfirst %}</h4>
            <ul class="list-unstyled" style="font-size: smaller;">
            {% with users=project.members %}{% for u in users %}
            	<li><a href="/profile/{{ u.0.username }}/" title="{% trans "view user profile" %}">{{ u.0.get_display_name }}</a>
            		{% if u.1 %}&nbsp; <i>{{ project.admin_name }}</i>
            			{% if can_delegate and u.0 != user %}      			
  	&nbsp;&nbsp;<form class="form-inline" style="margin: 0; padding: 0; display: inline-block;" action="/project/{{ project.id }}/toggle_supervisor_role/" method="post" onsubmit="return confirm_undelegate(this);" id="undelegate_{{ u.0.username }}">
	{% csrf_token %}<input type="hidden" name="user" value="{{ u.0.username }}">
    <input type="submit" class="btn-link" style="cursor: hand; padding:0; margin:0; font-size: x-small;" title="{% trans "call back supervisor role" %}" value="&#x25BE;" id="submit_{{ u.0.username }}">
	</form>
            			{% endif %}
            		{% else %}
            			{% if can_delegate %}
  	&nbsp;&nbsp;<form class="form-inline" style="margin: 0; padding: 0; display: inline-block;" action="/project/{{ project.id }}/toggle_supervisor_role/" method="post" onsubmit="return confirm_delegate(this);" id="delegate_{{ u.0.username }}">
	{% csrf_token %}<input type="hidden" name="user" value="{{ u.0.username }}">
    <input type="submit" class="btn-link" style="cursor: hand; padding:0; margin:0; font-size: x-small;" title="{% trans "grant supervisor role" %}" value="&#x25B4;" id="submit_{{ u.0.username }}">
	</form>
						{% endif %}
            		{% endif %}
            	</li>
            {% endfor %}{% endwith %}
			{% if can_accept_member %}
            {% with applications=project.get_applications %}
            {% if applications %}<h4 style="margin-top: 1.0em;">{% trans "applications"|capfirst %}</h4>{% endif %}
            {% for application in applications %}
            	<li><a href="/profile/{{ application.user.username }}/" title="{% trans "view user profile" %}">{{ application.user.get_display_name }}</a> &nbsp; - <a href="/project/{{ project.slug }}/accept/{{ application.user.username }}/"  title="{% trans "accept application to this community or project" %}">accept</a> -</li>
            {% endfor %}{% endwith %}
			{% endif %}
            </ul>
			{% if request.user.is_authenticated %}
			<hr />
			{% if membership == None and not project_no_apply %}
			<div>- <a href="/project/{{ project.slug }}/apply/{{ user.username }}/" title="{% trans "apply for membership" %}">{% trans "join project"|capfirst %}</a> -</div>
			{% else %}
				{% if membership.state == 0 %}					
				<div><i>{% trans "your application is waiting for acceptation by the " %}
				{% if membership.project.get_project_type == 'com' %}{% trans "community administrator" %}{% else %}{% trans "project supervisor" %}{% endif %}
				</i></div>
				{% endif %}
			{% endif %}
			{% endif %}
		{% endif %}

		{% if can_accept_member and not project.forum %}
   			<h4>{% trans "project forum"|capfirst %}</h4>
            <ul class="list-unstyled">
            	<li>- <a href="/project/{{ project.id }}/create_forum/">{% trans "create"|capfirst %} {% trans "project forum" %}</a> -</li>
            </ul>
		{% endif %}

		{% if can_accept_member %}
		{% if project.need_create_room or project.need_sync_xmppaccounts %}
   			<h4>{% trans "chat room"|capfirst %}</h4>
            <ul class="list-unstyled">
			{% if project.need_create_room %}
            	<li>- <a href="/project/{{ project.id }}/create_room/">{% trans "create"|capfirst %} {% trans "chat room" %}</a> -</li>
			{% endif %}
			{% if project.need_sync_xmppaccounts %}
            	<li>- <a href="/project/{{ project.id }}/sync_xmpp/">{% trans "add missing accounts"|capfirst %}</a> -</li>
			{% endif %}
            </ul>
		{% endif %}
		{% endif %}
		{% if project.get_children or can_edit and not project_no_children%}
   			<h4>{% if project.get_parent %}{% trans "child projects"|capfirst %}{% else %}{% trans "sub-communities"|capfirst %}{% endif %}</h4>
			{% if project.get_children %}
	            <ul class="list-unstyled">
				{% with subprojects=project.get_children %}{% for subproject in subprojects %}
	            	<li><a href="/project/{{ subproject.slug }}/" title="{% trans "view child project" %}">{{ subproject.get_name }}</a></li>
	            {% endfor %}{% endwith %}
	            </ul>
			{% endif %}
			{% if can_edit and not project_no_children %}
	            <ul class="list-unstyled">
					<li>- <a href="/project/{{ project.slug }}/project_new/" title="{% trans "create child project" %}">{% trans "create"|capfirst %}
						{% if project.get_parent %}{% trans "child project" %}{% else %}{% trans "sub-community" %}{% endif %}</a> -</li>
	            </ul>
			{% endif %}
		{% endif %}
  </div>
  <div class="col-sm-6">
    <section>
            <h2 class="text-center" style="color: {{ project.get_title_color }};">{% if project.proj_type.name = 'com' %}{% trans "community"|capfirst %}{% else %}{% trans "project"|capfirst %}{% endif %}:
			<i>{{ project.get_name }}</i>&nbsp;
			{% if can_edit %}&nbsp;<a href="/project/{{ project.slug }}/edit/" title="show edit view"><i class="fa fa-edit" style="font-size: 0.8em;""></i></a>{% endif %}
			</h2>
            <p class="lead">
			{% if project.description %}<div style="margin-bottom: 0.5em; font-style: italic;">{{ project.description }}</div>{% endif %}
            <div><strong>{% trans "project type"|capfirst %}</strong>: {{ proj_type.description }}</div>
		{% with parent=project.get_parent %}
			{% if parent %}
            <div><strong>{% if parent.proj_type.name == 'com' %}{% trans "parent community"|capfirst %}{% else %}{% trans "parent project"|capfirst %}{% endif %}</strong>:
            	<a href="/project/{{ parent.slug }}/" title="parent">{{ parent.get_name }}</a></div>
			{% endif %}
		{% endwith %}
    		{% if project.info %}
            <div style="margin-top: 0.5em;"><strong>{% trans "additional information"|capfirst %}</strong>:
				<div style="margin-left: 1.5em;">{{ project.info|safe }}</div></div>
			{% endif %}
            <div><strong>{% trans "project state"|capfirst %}</strong>: {{ project.get_state }}</div>
            </p>
    </section>
    {% if can_add_repo or can_add_oer or can_add_lp %}
    <section>
        <h4 class="text-center">{% trans "contribute"|capfirst %}</h4>
    	{% if can_add_repo %}<div><a href="/repo/new/"><i class="fa fa-plus" style="font-size: 0.7em;""></i> {% trans "classify external repository"|capfirst %}</a></div>{% endif %}
    	{% if can_add_oer %}<div><a href="/project/{{ project.id }}/oer_new/"><i class="fa fa-plus" style="font-size: 0.7em;""></i> {% trans "classify OER"|capfirst %}</a></div>{% endif %}
    	{% if can_add_lp %}<div><a href="/project/{{ project.id }}/lp_new/"><i class="fa fa-plus" style="font-size: 0.7em;""></i> {% trans "create learning path"|capfirst %}</a></div>{% endif %}
    </section>
	{% endif %}
    {% if user.is_authenticated %}
    <section>
        <h4 class="text-center">{% trans "interact"|capfirst %}</h4>
        {% if user.is_authenticated and project.forum %}
			<div style="margin-bottom: 5px;"><a href="{{ project.forum.get_absolute_url }}">- {% trans "view project forum"|capfirst %} -</a></div>
		{% endif %}
   		{% if user.is_authenticated and not project.proj_type.name == 'com' %}
        {% if project.has_chat_room %}
	        {% if can_chat %}
	            <i>{% trans "you are"|capfirst %} {% trans "member of the project chat room" %}</i>
	            <div style="margin-top: 270px;"></div>
		      	{% conversejs_chatpanel %}
		        {% conversejs_initialize %}
		        {% comment %}{% open_group_room %}{% endcomment %}
	        {% elif is_member %}
	            <i>{% trans "you are not yet"|capfirst %} {% trans "member of the project chat room" %}</i>
	        {% else %}
	            <i>{% trans "you are not"|capfirst %} {% trans "member of the project" %}</i>
			{% endif %}
        {% else %}
            <i>{% trans "no chat room has has been created for this project"|capfirst %}</i>
        {% endif %}  
        {% endif %}  
    </section>
	{% endif %}
  </div>
  <div class="col-sm-3" style="margin-top: 4.0em;">
  {% if project.get_project_type == 'oer' or project.get_project_type == 'lp' %}
    {% if oers or n_oers %}
		<h4>{% trans "recent OERs"|capfirst %}</h4>
		<ul class="list-unstyled" style="font-size: smaller;">
	        {% for oer in oers %}
	        <li><a href="/oer/{{ oer.slug }}/" style="color: {{ oer.get_link_color }};">{{ oer.title }}</a></li>
        	{% endfor %}
        	{% if n_oers > oers.count %}
	        <li><a href="/project/{{ project.slug }}/project_results/">...</a></li>
        	{% endif %}
        </ul>
	{% endif %}
    {% if lps %}
		<h4>{% trans "recent learning paths"|capfirst %}</h4>
		<ul class="list-unstyled" style="font-size: smaller;">
	        {% for lp in lps %}
	        <li><a href="/lp/{{ lp.slug }}/" style="color: {{ lp.get_link_color }};">{{ lp.title }}</a></li>
        	{% endfor %}
        </ul>
	{% endif %}
  {% endif %}
  </div>
</div>
{% endblock %}
