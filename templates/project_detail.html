{% extends "commons_base.html" %}

{% load i18n %}
{% if project.has_chat_room and can_chat %}
	{% load static from staticfiles %}
	{% load conversejs %}
{% endif %}

{% block head_title %}{% if proj_type.name = 'com' %}{% trans "community"|capfirst %}{% else %}{% trans "project"|capfirst %}{% endif %}: {{ project.get_name }}{% endblock %}

{% block extra_head %}
{% if project.has_chat_room and can_chat %}
	<link rel="stylesheet" href="{% static 'converse.js/converse.min.css' %}" type="text/css" media="screen, projection" />
	<script type="text/javascript" src="{% static 'converse.js/converse.min.js' %}"></script>
	<script>
		var room_label='{{ room_label }}';
		window.scrollTo(0, 2000);
	</script>
	<style>
		dl.add-converse-contact {
		    display: none;
		}
		a.toggle-online-users {
		    display: none;
		}
		a.change-xmpp-status-message {
		    display: none  !important;
		}
		form.add-chatroom label {
		    display: none;
		}
		form.add-chatroom input {
		    display: none;
		}
		div.button-group input.left {
		    display: none !important;
		    width: 100% !important;
		}
		div.button-group input.right {
		    display: block !important;
		    width: 100% !important;
		}
	</style>
{% endif %}
{% if can_delegate %}
	<script>
	function confirm_delegate(form) {return confirm('{% trans "do you really want to grant the admin or supervisor role to this member" %}?');}
	</script>
	<script>
	function confirm_undelegate(form) {return confirm('{% trans "do you really want to call back the admin or supervisor role from this member" %}?');}
	</script>
{% endif %}
{% endblock %}
{% block body_class %}project_detail{% endblock %}
{% block body %}
    {% comment %}{% for message in messages %}<div class="alert alert-{{ message.tags }}">{{ message }}</div>{% endfor %}{% endcomment %}
            <h1 class="text-center" style="color: {{ project.get_title_color }};">{% if project.proj_type.name = 'com' %}{% trans "community"|capfirst %}{% else %}{% trans "project"|capfirst %}{% endif %}:
			<i>{{ project.get_name }}</i>&nbsp;
			{% if can_edit %}&nbsp;<a href="/project/{{ project.slug }}/edit/" title="show edit view"><i class="fa fa-edit" style="font-size: 0.8em;""></i></a>{% endif %}
			</h1>
<div class="row bc-white marginB20">
  <div class="col-sm-3 col-md-3">
  		 {% if project.group.level > 0 %}
   			<h4>{% trans "members"|capfirst %}</h4>
            <ul class="list-unstyled" style="font-size: smaller;">
            {% with users=project.members %}{% for u in users %}
            	<li><a href="/profile/{{ u.0.username }}/" title="{% trans "view user profile" %}">{{ u.0.get_display_name }}</a>
            		{% if u.1 %}&nbsp; <i>{{ project.admin_name }}</i>
            			{% if can_delegate and u.0 != user %}      			
  	&nbsp;&nbsp;<form class="form-inline" style="margin: 0; padding: 0; display: inline-block;" action="/project/{{ project.id }}/toggle_supervisor_role/" method="post" onsubmit="return confirm_undelegate(this);" id="undelegate_{{ u.0.username }}">
	{% csrf_token %}<input type="hidden" name="user" value="{{ u.0.username }}">
    <input type="submit" class="btn-link" style="cursor: hand; padding:0; margin:0; font-size: smaller;" title="{% trans "call back supervisor role" %}" value="&#x25BE;" id="submit_{{ u.0.username }}">
	</form>
            			{% endif %}
            		{% else %}
            			{% if can_delegate %}
  	&nbsp;&nbsp;<form class="form-inline" style="margin: 0; padding: 0; display: inline-block;" action="/project/{{ project.id }}/toggle_supervisor_role/" method="post" onsubmit="return confirm_delegate(this);" id="delegate_{{ u.0.username }}">
	{% csrf_token %}<input type="hidden" name="user" value="{{ u.0.username }}">
    <input type="submit" class="btn-link" style="cursor: hand; padding:0; margin:0; font-size: smaller;" title="{% trans "grant supervisor role" %}" value="&#x25B4;" id="submit_{{ u.0.username }}">
	</form>
						{% endif %}
            		{% endif %}
            	</li>
            {% endfor %}{% endwith %}
			{% if can_accept_member %}
            {% with applications=project.get_applications %}
            {% if applications %}<h4 style="margin-top: 1.0em;">{% trans "applications"|capfirst %}</h4>{% endif %}
            {% for application in applications %}
            	<li><a href="/profile/{{ application.user.username }}/" title="{% trans "view user profile" %}">{{ application.user.get_display_name }}</a> &nbsp; - <a href="/project/{{ project.slug }}/accept/{{ application.user.username }}/"  title="{% trans "accept application to this community or project" %}">accept</a> -</li>
            {% endfor %}{% endwith %}
			{% endif %}
            </ul>
			{% if request.user.is_authenticated %}
			<hr />
			{% if membership == None and not project_no_apply %}
			<div>- <a href="/project/{{ project.slug }}/apply/{{ user.username }}/" title="{% trans "apply for membership" %}">{% trans "join project"|capfirst %}</a> -</div>
			{% else %}
				{% if membership.state == 0 %}					
				<div><i>{% trans "your application is waiting for acceptation by the " %}
				{% if membership.project.get_project_type == 'com' %}{% trans "community administrator" %}{% else %}{% trans "project supervisor" %}{% endif %}
				</i></div>
				{% endif %}
			{% endif %}
			{% endif %}
		{% endif %}

		{% if is_admin %}
		{% if proj_type.name == 'com' or not project.forum %}
   			<h4>{% trans "forum"|capfirst %}</h4>
            <ul class="list-unstyled">
		{% endif %}
		{% if not project.forum %}
            	<li>- <a href="/project/{{ project.id }}/create_forum/">{% trans "create"|capfirst %} {% trans "project forum" %}</a> -</li>
		{% endif %}
		{% if proj_type.name == 'com' %}
            	<li>- <a href="/project/{{ project.id }}/create_forum/?thematic=true">{% trans "create"|capfirst %} {% trans "thematic forum" %}</a> -</li>
		{% endif %}
            </ul>
		{% endif %}

		{% if can_accept_member %}
		{% if project.need_create_room or project.need_sync_xmppaccounts %}
   			<h4>{% trans "chatroom"|capfirst %}</h4>
            <ul class="list-unstyled">
			{% if project.need_create_room %}
            	<li>- <a href="/project/{{ project.id }}/create_room/">{% trans "create"|capfirst %} {% trans "chatroom" %}</a> -</li>
			{% endif %}
			{% if project.need_sync_xmppaccounts %}
            	<li>- <a href="/project/{{ project.id }}/sync_xmpp/">{% trans "add missing accounts"|capfirst %}</a> -</li>
			{% endif %}
            </ul>
		{% endif %}
		{% endif %}
		{% if project.get_children or can_edit and not project_no_children%}
   			<h4>{% if project.get_parent %}{% trans "child projects"|capfirst %}{% else %}{% trans "sub-communities"|capfirst %}{% endif %}</h4>
			{% if project.get_children %}
	            <ul class="list-unstyled">
				{% with subprojects=project.get_children %}{% for subproject in subprojects %}
	            	<li><a href="/project/{{ subproject.slug }}/" title="{% trans "view child project" %}">{{ subproject.get_name }}</a></li>
	            {% endfor %}{% endwith %}
	            </ul>
			{% endif %}
			{% if can_edit and not project_no_children %}
	            <ul class="list-unstyled">
					<li>- <a href="/project/{{ project.slug }}/project_new/" title="{% trans "create child project" %}">{% trans "create"|capfirst %}
						{% if project.get_parent %}{% trans "child project" %}{% else %}{% trans "sub-community" %}{% endif %}</a> -</li>
	            </ul>
			{% endif %}
		{% endif %}
  </div>
  <div class="col-sm-6 col-md-6">
<section>
            <p class="lead">
			{% if project.description %}<div style="margin-bottom: 0.5em; font-style: italic;">{{ project.description }}</div>{% endif %}
            <div><strong>{% trans "project type"|capfirst %}</strong>: {{ proj_type.description }}</div>
		{% with parent=project.get_parent %}
			{% if parent %}
            <div><strong>{% if parent.proj_type.name == 'com' %}{% trans "parent community"|capfirst %}{% else %}{% trans "parent project"|capfirst %}{% endif %}</strong>:
            	<a href="/project/{{ parent.slug }}/" title="parent">{{ parent.get_name }}</a></div>
			{% endif %}
		{% endwith %}
    		{% if project.info %}
            <div style="margin-top: 0.5em;"><strong>{% trans "additional information"|capfirst %}</strong>:
				<div style="margin-left: 1.5em;">{{ project.info|safe }}</div></div>
			{% endif %}
            <div><strong>{% trans "project state"|capfirst %}</strong>: {{ project.get_state }}</div>
            </p>
    </section>
    {% if can_add_repo or can_add_oer or can_add_lp %}
    <section>
        <h4 class="text-center">{% trans "contribute"|capfirst %}</h4>
{% comment %}
    	{% if can_add_repo %}<div><a href="/repo/new/"><i class="fa fa-plus" style="font-size: 0.7em;""></i> {% trans "classify external repository"|capfirst %}</a></div>{% endif %}
    	{% if can_add_oer %}<div><a href="/project/{{ project.id }}/oer_new/"><i class="fa fa-plus" style="font-size: 0.7em;""></i> {% trans "classify OER"|capfirst %}</a></div>{% endif %}
    	{% if can_add_lp %}<div><a href="/project/{{ project.id }}/lp_new/"><i class="fa fa-plus" style="font-size: 0.7em;""></i> {% trans "create learning path"|capfirst %}</a></div>{% endif %}
{% endcomment %}
		<ul class="list-unstyled">
    	{% if can_add_repo %}
    	<li style="margin-top: 0em;"><a href="/repo/new/" class="btn btn-default btn-primary btn-sm">{% trans "classify external repository"|capfirst %}</a></li>
    	{% endif %}
    	{% if can_add_oer %}
    	<li style="margin-top: 0.4em;"><a href="/project/{{ project.id }}/oer_new/" class="btn btn-default btn-primary btn-sm">{% trans "classify OER"|capfirst %}</a></li>
	    	{% if cut_oers %}{% for oer in cut_oers %}
    		<li style="margin-top: 0.2em;"><a href="/project/{{ project.id }}/paste_oer/{{ oer.id }}/" class="btn btn-default btn-warning btn-sm">{% trans "paste OER"|capfirst %} "{{ oer.title|truncatewords:5 }}"</a></li>
	    	{% endfor %}{% endif %}
    	{% endif %}
    	{% if can_add_lp %}
    	<li style="margin-top: 0.4em;"><a href="/project/{{ project.id }}/lp_new/" class="btn btn-default btn-primary btn-sm">{% trans "create learning path"|capfirst %}</a></li>
	    	{% if cut_lps %}{% for lp in cut_lps %}
    		<li style="margin-top: 0.2em;"><a href="/project/{{ project.id }}/paste_lp/{{ lp.id }}/" class="btn btn-default btn-warning btn-sm">{% trans "paste LP"|capfirst %} "{{ lp.title|truncatewords:5 }}"</a></li>
	    	{% endfor %}{% endif %}
    	{% endif %}
		<ul>
    </section>
	{% endif %}
    {% if user.is_authenticated %}
    <section>
        <h4 class="text-center">{% trans "interact"|capfirst %}</h4>
        {% if is_member or user.is_superuser %}
			<div style="margin-bottom: 5px;"><a href="/project/{{ project.slug }}/folder/">- {% trans "view the shared folder"|capfirst %} -</a></div>
		{% endif %}
        {% if user.is_authenticated and project.forum %}
			<div style="margin-bottom: 5px;"><a href="{{ project.forum.get_absolute_url }}">-
			{% if proj_type.name = 'com' %}{% trans "view the community forum"|capfirst %}{% else %}{% trans "view the project forum"|capfirst %}{% endif %}
			-</a></div>
		{% endif %}
   		{% if user.is_authenticated and not proj_type.name == 'com' %}
        {% if is_member %}
			<div style="margin-bottom: 5px;">
  	<form class="form-inline" style="margin: 0; padding: 0; display: inline-block;" action="/project/{{ project.id }}/compose_message/" method="post">
	{% csrf_token %}
    <input type="submit" class="btn-link" style="cursor: hand; padding:0; margin:0;" value="- {% trans "send message to members"|capfirst %} -">
	</form>
			</div>
		{% endif %}
        {% if project.has_chat_room %}
	        {% if can_chat %}
{% comment %}
	            <i>{% trans "you are"|capfirst %} {% trans "member of the project chatroom" %}</i>
	            <div style="margin-top: 270px;"></div>
		      	{% conversejs_chatpanel %}
		        {% conversejs_initialize %}
{% endcomment %}
				<div style="margin-bottom: 5px;"><a href="/my_chat/">- {% trans "view the project chatroom"|capfirst %} -</a></div>
	        {% elif is_member %}
	            <i>{% trans "you are not yet"|capfirst %} {% trans "member of the project chatroom" %}</i>
	        {% else %}
	            <i>{% trans "you are not"|capfirst %} {% trans "member of the project" %}</i>
			{% endif %}
        {% else %}
            <i>{% trans "no chatroom has has been created for this project"|capfirst %}</i>
        {% endif %}  
        {% endif %}
    </section>
	{% endif %}
  </div>
  <div class="col-sm-3 col-md-3">
  {% if project.get_project_type == 'oer' or project.get_project_type == 'lp' %}
    {% if lps %}
		<h4>{% trans "recent learning paths"|capfirst %}</h4>
		<ul class="list-unstyled" style="font-size: smaller;">
	        {% for lp in lps %}
	        <li><a href="/lp/{{ lp.slug }}/" style="color: {{ lp.get_link_color }};">{{ lp.title }}</a></li>
        	{% endfor %}
        </ul>
	{% endif %}
    {% if oers or n_oers %}
		<h4>{% trans "recent OERs"|capfirst %}</h4>
		<ul class="list-unstyled" style="font-size: smaller; margin-bottom: 20px">
	        {% for oer in oers %}
	        <li><a href="/oer/{{ oer.slug }}/" style="color: {{ oer.get_link_color }};">{{ oer.title }}</a></li>
        	{% endfor %}
        	{% if n_oers > oers.count %}
	        <li style="padding-top:8px"><a class="btn" style="padding:2px 6px; color: #2e6da4; border-color: #2e6da4; font-size: 12px" href="/project/{{ project.slug }}/project_results/">{% trans "read more" %}</a></li>
        	{% endif %}
        </ul>
	{% endif %}
    {% if oer_evaluations %}
		<h4>{% trans "recent OER evaluations"|capfirst %}</h4>
		<ul class="list-unstyled" style="font-size: smaller;">
	        {% for oer_evaluation in oer_evaluations %}
	        <li><a href="/oer_evaluation/{{ oer_evaluation.id }}/">{{ oer_evaluation.oer.title }}</a></li>
        	{% endfor %}
        	{% if n_oer_evaluations > oer_evaluations.count %}
	        <li  style="padding-top:8px"><a class="btn" style="padding:2px 6px; color: #2e6da4; border-color: #2e6da4; font-size: 12px" href="/project/{{ project.slug }}/project_results/">{% trans "read more" %}</a></li>
        	{% endif %}
        </ul>
	{% endif %}
  {% endif %}
  </div>
</div>

{% endblock %}
