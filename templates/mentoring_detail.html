{% extends "commons_base.html" %}

{% load i18n %}

{% block head_title %}{% if proj_type.name = 'com' %}{% trans "community"|capfirst %}{% else %}{% trans "project"|capfirst %}{% endif %}: {{ project.get_name }}{% endblock %}

{% block languages %}{% include "_hreflang.html" %}{% endblock %}

{% block extra_head %}
<style>
    ul#id_mentor { list-style-type: none; display:inline }
    ul#id_mentor li {width:20%; float:left; height:250px; vertical-align:top;  }
    ul#id_mentor li label {font-weight: normal;  font-size: 12px; }

dl.eval {
	background: white;
	margin-bottom:5px;
}
dl.eval dd {
	padding:20px 20px 10px 20px;
}
dl.eval dd:nth-child(odd) {
    background: transparent;
}
dl.eval dd:nth-child(even) {
    background: #f8f8f8;
}

div.msg {
	background: white;
	margin-left: 15px;
	margin-right: 15px;
	padding: 8px 12px;
	border: 1px solid red;
	color: red;
	font-style: italic;
}

</style>
{% endblock %}

{% block body_class %}mentoring_detail{% endblock %}
{% block body %}
<div class="marginT30 marginB20" style="background:#EBEDED; border-bottom: 6px solid #67AE73; border-bottom-left-radius: 6px; border-bottom-right-radius: 6px;">
  <div class="bc-c0 c-white" style="padding:10px 20px 0 20px; border-top-left-radius:6px; border-top-right-radius:6px">
    <ul class="list-inline marginB0">
      {% with users=project.members %}
      {% for u in users %}
        <li class="marginB10">
          {% if u.0.get_profile.avatar %}
            <img src="/media/{{  u.0.get_profile.avatar }}" class="avatar-medium">
          {% else %}
            <img src="/media/images/avatars/anonymous.png" class="avatar-medium">
          {% endif %}
            <a href="/profile/{{ u.0.username }}/" title="{% trans "view user profile" %}" class="btn btn-default font12">{{ u.0.get_display_name }}<br><i>{% if u.1 %}{{ project.admin_name }}{% else %}{% trans "mentee" %}{% endif %}</i></a>
        </li>
      {% endfor %}
      {% if users|length == 1 %}
         <li class="marginB10 c-white font12"><img src="/media/images/avatars/question.png" class="avatar-medium"> &nbsp;<i>{% trans "mentor" %}</i></li>
      {% endif %}
      {% endwith %}
      <li class="marginB10"><h1 class="font-small c-white" style="margin:0">{{ project.get_name }}</h1></li>
    </ul>
  </div>
  <p style="background:white; padding:6px 15px">
   {% if is_closed %}
     <span class="neutral"><i class="fa fa-lock" aria-hidden="true"></i> </span>
   {% endif %}	
   {% if is_draft %}
     <span class="orange"><i class="fa fa-user" aria-hidden="true"></i><i class="fa fa-arrows-h" aria-hidden="true"></i><i class="fa fa-user" aria-hidden="true"></i> </span>
   {% elif is_submitted %}
     <span class="limegreen"><i class="fa fa-user" aria-hidden="true"></i><i class="fa fa-arrows-h" aria-hidden="true"></i><i class="fa fa-user" aria-hidden="true"></i> </span>
   {% elif is_open or is_closed %}
      <span class="neutral"><i class="fa fa-user" aria-hidden="true"></i><i class="fa fa-arrows-h" aria-hidden="true"></i><i class="fa fa-user" aria-hidden="true"></i> </span>
   {% elif is_deleted %}
     <span class="red"><i class="fa fa-user" aria-hidden="true"></i><i class="fa fa-arrows-h" aria-hidden="true"></i><i class="fa fa-user" aria-hidden="true"></i> </span>
   {% endif %}
   {{ proj_type.description }}
   {% with parent=project.get_parent %}
     &nbsp; - &nbsp;{% trans "community"|capfirst %}: <a href="/project/{{ parent.slug }}/">{{ parent.get_name }}</a>
   {% endwith %}
  </p>
  {% if view_project_text %}
      <div class="msg">{% trans "a request must be submitted to the community administrator, which will try to allocate a mentor"|capfirst %}.</div>
  {% endif %}
  <div class="row marginLR0 paddingT10">
    <div class="col-sm-7 col-md-7 col-lg-8">
     {% if select_mentor_B %}
       {% include "_mentors_refuse.html" %}
       {% include "_candidate_mentors.html" %}
       {% include "_project_mentoring_text.html" %}
     {% elif select_mentor_A %}
       {% include "_project_mentoring_text.html" %}
       {% include "_mentors_refuse.html" %}
       {% include "_candidate_mentors.html" %}
     {% elif view_project_text %}
       {% include "_mentors_refuse.html" %}
       {% include "_project_mentoring_text.html" %}
     {% endif %}
     {% if is_submitted %}
       {% if is_mentee or is_only_parent_admin %}
         {% include "_mentors_refuse.html" %}
         {% include "_selected_mentor.html" %}
         {% include "_project_mentoring_text.html" %}
       {% elif can_accept_mentor %}
         {% include "_project_mentoring_text.html" %}
         {% if requested_mentor_refuse %}
         <div class="panel-white">
           <h6 class="bc-c0 c-white padding510 margin0" style="border-top-left-radius:4px; border-top-right-radius:4px;">{% trans "my previous refusals"|capfirst %}</h6>
           <dl class="eval font12">
            {% for mentor_refuse in requested_mentor_refuse %}
              <dd>
                <div class="row">
                  <div class="col-md-10 col-lg-10">{{ mentor_refuse.history }}</div>
                  <div class="col-md-2 col-lg-2">{{ mentor_refuse.refused|date:"d/m/Y" }}</div>
                </div>
              </dd>
            {% endfor %}
            </dl>
         </div>
       {% endif %}
         <div class="panel panel-c0">
         <form method="post" action="/accept_mentor/" name="accept_mentor_form" id="ud_accept_mentor_form">{% csrf_token %}
           {% for hidden in accept_mentor_form.hidden_fields %}{{ hidden }}{% endfor %}
           <fieldset class="padding510">
             {% for field in accept_mentor_form.visible_fields %}
               <div class="form-group">
                 <label for="{{ field.name }}" {% if field.field.required %}class="required"{% endif %}>{{ field.label|capfirst}}</label> &nbsp;
                 <span class="txt-error">{{ field.errors }}</span>{{ field }}
                 {% if field.help_text %}<small id="{{ field.name }}helpBlock" class="help-block">{{ field.help_text }}</small>{% endif %}
               </div>
             {% endfor %}
           </fieldset>
           <div class="panel-footer-c0 padding510"><button type="submit" name="save" id="save" value="save" class="btn btn-default">{% trans "confirm your choice"|capfirst %}</button></div>
         </form></div>
         {% endif %}
     {% elif is_open or is_closed %}
       {% include "_project_mentoring_text.html" %}  
     {% endif %}

     {% if can_send_message and is_member %}
       <div class="panel-white">
         <ul class="nav nav-tabs" style="background:#ebeded; border-top-left-radius:4px; border-top-right-radius:4px;">
           <li class="active"><a data-toggle="tab" href="#inbox">{% trans "received messages"|capfirst %}</a></li>
           <li><a data-toggle="tab" href="#outbox">{% trans "sent messages"|capfirst %}</a></li>
           <li><a data-toggle="tab" href="#compose">{% trans "new message"|capfirst %}</a></li>
         </ul>
         <div class="tab-content padding510">
           <div id="inbox" class="tab-pane fade in active">
             {% if inbox %}
               <ul class="list-unstyled my-list-unstyled padding510">
                {% for msg in inbox %}
                  <li><small><a href="/my_mail/view/{{ msg.id }}/">{{ msg.subject }}</a> &nbsp; &nbsp; [{{ msg.sent_at }}]</small></li>
                {% endfor %}
               </ul>
             {% else %}
               <p><small>{% trans "no messages received"|capfirst %}</small></p>
             {% endif %}
           </div>
           <div id="outbox" class="tab-pane fade">
             {% if outbox %}
               <ul class="list-unstyled my-list-unstyled padding510">
                 {% for msg in outbox %}
                   <li><small><a href="/my_mail/view/{{ msg.id }}/">{{ msg.subject }}</a> &nbsp; &nbsp; [{{ msg.sent_at }}]</small></li>
                 {% endfor %}
               </ul>
             {% else %}
               <p><small>{% trans "no messages sent"|capfirst %}</small></p>
             {% endif %}
           </div>
           <div id="compose" class="tab-pane fade">
             <form method="post" action="/project/{{ project.slug }}/send_one2one_message/" class="padding510">{% csrf_token %}
               {% for hidden in compose_message_form.hidden_fields %}{{ hidden }}{% endfor %}
               {% for field in compose_message_form.visible_fields %}
                 <div class="form-group">
                   <label for="{{ field.name }}" {% if field.field.required %}class="required"{% endif %}>{{ field.label|capfirst}}</label>
                     <span class="txt-error">{{ field.errors }}</span>{{ field }}
                 </div>
               {% endfor %}
               <div class="form-group"><input type="submit" class="btn btn-default" name="send" value="{% trans "send" %}"></div>
             </form>
           </div>
         </div>
       </div>
     {% endif %}
   </div>
 
   {# if is_open or is_closed #}
   <div class="col-sm-5 col-md-5 col-lg-4">
     {% if can_propose == 'A' %}
       <ul class="list-inline marginLB020"><li class="list-back-c0"><ul class="list-inline"><li class="marginB5"><a href="/project/{{ project.id }}/propose/" title="{% trans "submit request to admin" %}" class="btn btn-default"><i class="fa fa-mail-forward"></i> {% trans "submit request" %}</a></li></ul></li></ul>
{% comment %}
     {% elif can_propose == 'B' and requested_mentor %}
       <ul class="list-inline marginLB020"><li class="list-back-c0"><ul class="list-inline"><li class="marginB5"><a href="/project/{{ project.id }}/propose/" title="{% trans "submit request to mentor" %}" class="btn btn-default"><i class="fa fa-mail-forward"></i> {% trans "submit request" %}</a></li></ul></li></ul>
{% endcomment %}
     {% elif can_propose == 'C' %}
       <ul class="list-inline marginLB020"><li class="list-back-c0"><ul class="list-inline"><li class="marginB5"><a href="/project/{{ project.id }}/propose/" title="{% trans "submit request" %}" class="btn btn-default"><i class="fa fa-mail-forward"></i> {% trans "submit request" %}</a></li></ul></li></ul>
     {% endif %}
     {% if can_draft_back and mentors_refuse %}
     <ul class="list-inline marginLB020"><li class="list-back-c0 width-full paddingLT4">
     	<dl class="bc-white font14 marginB0 padding510 borderRadius4" >
        <dd><form method="POST" action="/project/{{ project.id }}/draft_back/" id="id_draft_back_form" name="draft_back_form">{% csrf_token %}
          <input type="hidden" name="admin" value="{{ user }}">
          <div class="form-group">
          <label for="id_message">{% trans "message"|capfirst %}</label>
          <textarea name="message" class="form-control" id="message"></textarea>
          <small id="urlhelpBlock" class="help-block">{% trans "testo verra' inviato al mentee" %}</small>
          </div>
       <div class="form-group"><button name="draft_back" id="id_draft_back" title="{% trans "back to draft state" %}" class="btn btn-default" value="draft"><i class="fa fa-reply"></i> {% trans "back to draft state" %}</button></div>
     </form></dd>
   </dl></li></ul>

     {% endif %}

     {% if can_close %}<ul class="list-inline marginLB020"><li class="list-back-c0"><ul class="list-inline"><li class="marginB5"><a href="/project/{{ project.id }}/close/" title="{% trans "close" %}" class="btn btn-default"><i class="fa fa-lock"></i> {% trans "close" %}</a></li></ul></li></ul>{% endif %}

         <ul class="list-inline marginLB020">
         {% if view_shared_folder %}
           <li class="list-back-black marginB5"><ul class="list-inline"><li class="marginB5"><a href="/project/{{ project.slug }}/folder/" class="btn btn-default"><i class="fa fa-folder-open-o"></i> {% trans "view the shared folder" %}</a></li></ul></li>
         {% endif %}
         {% if is_admin and is_open and project.need_create_room %}
           <li class="list-back-black marginB5"><ul class="list-inline"><li class="marginB5"><a href="/project/{{ project.id }}/create_room/" class="btn btn-default"><i class="fa fa-comments-o"></i> {% trans "enable chatroom" %}</a></li></ul></li> 
         {% endif %}
       </ul>
          {% if can_add_oer or can_add_lp %}
          <div>
            <ul class="list-inline padding10510">
            {% if can_add_oer %}
                <li class="list-back-c2 marginB5">
                   <ul class="list-inline">
                      <li><div class="c-white marginB5 demiBold">{% trans "OER" %}</div>
                         <ul class="list-inline list-last">
                            <li class="marginB5"><a href="/project/{{ project.id }}/oer_new/" class="btn btn-default"><i class="fa fa-file-text-o"></i> {% trans "classify"|capfirst %}</a></li>
{% comment %}
                            {% if cut_oers %}{% for oer in cut_oers %}
                              <li class="marginB5"><a href="/project/{{ project.id }}/paste_oer/{{ oer.id }}/" class="btn btn-default" title="{{ oer.title }}"><i class="fa fa-clipboard"></i> {% trans "paste"|capfirst %} "{{ oer.title|truncatewords:5 }}"</a></li>
                            {% endfor %}{% endif %}
{% endcomment %}
                            {% if shareable_oers %}{% for oer in shareable_oers %}
                              <li class="marginB5"><a href="/project/{{ project.id }}/add_shared_oer/{{ oer.id }}/" class="btn btn-default" title="{{ oer.title }}"><i class="fa fa-share-alt"></i> {% trans "share"|capfirst %} "{{ oer.title|truncatewords:5 }}"</a></li>
                            {% endfor %}{% endif %}
                         </ul>
                      </li>
                   </ul>
                </li>
              {% endif %}
              {% if can_add_lp %}
                <li class="list-back-c1 marginB5">
                   <ul class="list-inline">
                      <li><div class="c-white marginB5 demiBold">{% trans "LP" %}</div>
                         <ul class="list-inline list-last">
                            <li class="marginB5"><a href="/project/{{ project.id }}/lp_new/" class="btn btn-default"><i class="fa fa-file-o"></i> {% trans "create"|capfirst %}</a></li>
{% comment %}
                            {% if cut_lps %}{% for lp in cut_lps %}
                              <li class="marginB5"><a href="/project/{{ project.id }}/paste_lp/{{ lp.id }}/" class="btn btn-default"  title="{{ lp.title }}"><i class="fa fa-clipboard"></i> {% trans "paste"|capfirst %} "{{ lp.title|truncatewords:5 }}"</a></li>
                            {% endfor %}{% endif %}
{% endcomment %}
                            {% if shareable_lps %}{% for lp in shareable_lps %}
                              <li class="marginB5"><a href="/project/{{ project.id }}/add_shared_lp/{{ lp.id }}/" class="btn btn-default" title="{{ lp.title }}"><i class="fa fa-share-alt"></i> {% trans "share"|capfirst %} "{{ lp.title|truncatewords:5 }}"</a></li>
                            {% endfor %}{% endif %}
                         </ul>
                      </li>
                   </ul>
                </li>
              {% endif %}
            </ul>
            </div>
            {% endif %}
            

         {% if lps %}
           <div class="panel-white">
             <div class="panel-heading-c1 padding510 demiBold">{% trans "last learning paths"|capfirst %}</div>
             <ul class="list-unstyled my-list-unstyled padding510">
             {% for lp in lps %}
               <li>{% if lp.state != 3 %}<small style="color: {{ lp.get_link_color }};">[{{ lp.get_state }}]</small> {% endif %}<a href="/lp/{{ lp.slug }}/"><small>{{ lp.title }}</small></a></li>
             {% endfor %}
             </ul>
             {% if n_lps > lps|length %}
               <div class="panel-footer-c1 padding510 text-center demiBold"><a href="/project/{{ project.slug }}/project_results/#p_lps">{% trans "read more"|upper %}</a></div>
             {% endif %}
           </div>
         {% endif %}
         {% if shared_lps %}
           <div class="panel-white">
             <div class="panel-heading-c1 padding510 demiBold">{% trans "shared LPs"|capfirst %}</div>
             <ul class="list-unstyled my-list-unstyled padding510">
             {% for shared_lp, deletable in shared_lps %}
               <li>{% if deletable %}<a class="deleteNode" href="/shared_lp_delete/{{ shared_lp.id }}/" title="{% trans "unshare this LP" %}"><i class="fa fa-times-circle red"></i></a>{% endif %}
                   <a href="/lp/{{ shared_lp.lp.slug }}/">{{ shared_lp.lp.title }}</a>
               </li>
             {% endfor %}
             </ul>
           </div>
         {% endif %}
         {% if oers %}
           <div class="panel-white">
             <div class="panel-heading-c2 padding510 demiBold">{% trans "last OERs"|capfirst %}</div>
             <ul class="list-unstyled my-list-unstyled padding510">
             {% for oer in oers %}
               <li>{% if oer.state != 3 %}<small style="color: {{ oer.get_link_color }};">[{{ oer.get_state }}]</small> {% endif %}<a href="/oer/{{ oer.slug }}/"><small>{{ oer.title }}</small></a> </li>
             {% endfor %}
             </ul>
             {% if n_oers > oers.count %}
               <div class="panel-footer-c2 padding510 text-center demiBold"><a href="/project/{{ project.slug }}/project_results/#p_oers">{% trans "read more"|upper %}</a></div>
             {% endif %}
           </div>
         {% endif %}
         {% if shared_oers %}
           <div class="panel-white">
             <div class="panel-heading-c2 padding510 demiBold">{% trans "shared OERs"|capfirst %}</div>
             <ul class="list-unstyled my-list-unstyled padding510">
             {% for shared_oer, deletable in shared_oers %}
               <li>{% if deletable %}<a class="deleteNode"  href="/shared_oer_delete/{{ shared_oer.id }}/" title="{% trans "unshare this OER" %}"><i class="fa fa-times-circle red"></i></a>{% endif %}
                   <a href="/oer/{{ shared_oer.oer.slug }}/">{{ shared_oer.oer.title }}</a>
               </li>
             {% endfor %}
             </ul>
           </div>
         {% endif %}

   </div>
   {# endif #}
  </div>
</div>
{% endblock %}
